<div class="container">
  <div class="page-header">
    <h1>Listado de Operaciones</h1>
    <button
      mat-raised-button
      color="primary"
      (click)="createPanelOpen = !createPanelOpen"
    >
      <span class="material-icons">add</span>
      Crear Transacción
    </button>
  </div>

  <!-- Tabla de operaciones -->
  <mat-card>
    <div style="overflow: auto">
      <table mat-table [dataSource]="data" class="mat-elevation-z1">
        <!-- Nombre -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Nombre</th>
          <td mat-cell *matCellDef="let tx">{{ tx.nombre }}</td>
        </ng-container>

        <!-- Tipo -->
        <ng-container matColumnDef="tipo">
          <th mat-header-cell *matHeaderCellDef>Tipo</th>
          <td mat-cell *matCellDef="let tx">{{ tx.tipo }}</td>
        </ng-container>

        <!-- Importe -->
        <ng-container matColumnDef="importe">
          <th mat-header-cell *matHeaderCellDef class="cell-right">Importe</th>
          <td mat-cell *matCellDef="let tx" class="cell-right">
            <span
              [ngClass]="{
                'amount-pos': tx.importe > 0,
                'amount-neg': tx.importe < 0,
              }"
            >
              {{ tx.importe | number: "1.2-2" }} €
            </span>
          </td>
        </ng-container>

        <!-- Estado -->
        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let tx">
            <mat-chip-set>
              <mat-chip [color]="chipColor(tx.estado)" selected>
                {{ tx.estado }}
              </mat-chip>
            </mat-chip-set>
          </td>
        </ng-container>

        <!-- Fecha -->
        <ng-container matColumnDef="creada">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td mat-cell *matCellDef="let tx">
            {{ tx.creada | date: "yyyy-MM-dd" }}
          </td>
        </ng-container>

        <!-- Acciones -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef class="cell-right">Acciones</th>
          <td mat-cell *matCellDef="let tx" class="cell-right">
            <button
              mat-stroked-button
              color="primary"
              (click)="goDetail(tx._id)"
            >
              <span class="material-icons">visibility</span>
              Ver detalle
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <mat-divider></mat-divider>

    <mat-paginator
      [length]="totalItems"
      [pageSize]="limit"
      [pageIndex]="page - 1"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPage($event)"
    >
    </mat-paginator>
  </mat-card>

  <!-- Crear transacción -->
  <mat-card *ngIf="createPanelOpen" style="margin-top: 16px">
    <form [formGroup]="createForm" (ngSubmit)="create()">
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Tipo</mat-label>
          <mat-select formControlName="tipo">
            <mat-option [value]="'Transferencia'">Transferencia</mat-option>
            <mat-option [value]="'Pago'">Pago</mat-option>
            <mat-option [value]="'Domiciliación'">Domiciliación</mat-option>
            <mat-option [value]="'Inversión'">Inversión</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Importe</mat-label>
          <input matInput type="number" formControlName="importe" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Estado</mat-label>
          <mat-select formControlName="estado">
            <mat-option [value]="'Pendiente'">Pendiente</mat-option>
            <mat-option [value]="'Completado'">Completado</mat-option>
            <mat-option [value]="'Procesando'">Procesando</mat-option>
            <mat-option [value]="'Fallido'">Fallido</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Fecha</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="creada" />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <div style="align-self: center">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="createForm.invalid"
          >
            <span class="material-icons">save</span>
            Crear
          </button>
        </div>
      </div>
    </form>
  </mat-card>

  <!-- Cargando -->
  <div
    style="display: flex; justify-content: center; margin: 24px 0"
    *ngIf="loading"
  >
    <mat-progress-spinner
      mode="indeterminate"
      diameter="36"
    ></mat-progress-spinner>
  </div>

  <!-- Error -->
  <mat-card
    *ngIf="error"
    style="border-left: 4px solid #e53935; margin-top: 16px"
  >
    {{ error }}
  </mat-card>
</div>
